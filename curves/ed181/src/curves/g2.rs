use ark_ec::{
    models::{CurveConfig},
};
use ark_ec::twisted_edwards::{Affine, MontCurveConfig, Projective, TECurveConfig};
use ark_ff::{AdditiveGroup, Field, MontFp, Fp3Config};

use crate::{Fq, Fq3, Fq3Config, Fr};

pub type G2Affine = Affine<Config>;
pub type G2Projective = Projective<Config>;

#[derive(Clone, Default, PartialEq, Eq)]
pub struct Config;

impl CurveConfig for Config {
    type BaseField = Fq3;
    type ScalarField = Fr;

    /// COFACTOR =
    /// 154258591909741381741574597309115244440098711884745341598358011590913382484763414823089748530029669074232934400
    #[rustfmt::skip]
    const COFACTOR: &'static [u64] = &[
        0xa84db14100000000,
        0xd24e30baf43d09a8,
        0x3e92a06d2247386d,
        0xc73a8911cfc52edf,
        0xf26443b9e16fcbc4,
        0x000041aec4b3afaa
    ];

    /// COFACTOR^(-1) mod r =
    /// 233300837856922578737770726591138895383105927685250938
    const COFACTOR_INV: Fr = MontFp!("233300837856922578737770726591138895383105927685250938");
}

impl TECurveConfig for Config {
    /// COEFF_A = u
    const COEFF_A: Fq3 = Fq3::new(Fq::ZERO, Fq::ONE, Fq::ZERO);

    /// COEFF_B = 600581931845324488256649384912508268813600056237543024*u
    const COEFF_D: Fq3 = Fq3::new(
        Fq::ZERO,
        MontFp!("600581931845324488256649384912508268813600056237543024"),
        Fq::ZERO
    );

    /// AFFINE_GENERATOR_COEFFS = (G2_GENERATOR_X, G2_GENERATOR_Y)
    const GENERATOR: G2Affine = G2Affine::new_unchecked(G2_GENERATOR_X, G2_GENERATOR_Y);

    type MontCurveConfig = Config;

    #[inline(always)]
    fn mul_by_a(elem: Self::BaseField) -> Self::BaseField {
        // Fq3::new(g2_a*Fq3::NONRESIDUE * elem.c2, g2_a*elem.c0, g2_a*elem.c1), g2_a = 1
        Fq3::new(Fq3Config::NONRESIDUE * elem.c2, elem.c0, elem.c1)
    }
}

impl MontCurveConfig for Config {
    /// COEFF_A = 3633873325914583757878111665460483522889356159676216271
    const COEFF_A: Fq3 = Fq3::new(
        MontFp!("3633873325914583757878111665460483522889356159676216271"),
        Fq::ZERO,
        Fq::ZERO
    );

    /// COEFF_B = 1993847731372119391014344758070394602276075906323905972*u^2
    const COEFF_B: Fq3 = Fq3::new(
        Fq::ZERO,
        Fq::ZERO,
        MontFp!("1993847731372119391014344758070394602276075906323905972"),
    );

    type TECurveConfig = Config;
}

/// G2_GENERATOR_X =
///  2086094117216480016835819591131196745348260120048935989*u^2 + 5429622869467499454611801972368257535710931658342466468*u + 5142116834052774225311015682942985610040978601495797864
pub const G2_GENERATOR_X: Fq3 = Fq3::new(
    MontFp!("5142116834052774225311015682942985610040978601495797864"),
    MontFp!("5429622869467499454611801972368257535710931658342466468"),
    MontFp!("2086094117216480016835819591131196745348260120048935989"),
);

/// G2_GENERATOR_Y =
/// 1004641194455218522835921962111776576604869191168662685*u^2 + 239881760419386810121648775340825961114749150029120073*u + 373973480499824152749816795774535692130126081236112366
pub const G2_GENERATOR_Y: Fq3 = Fq3::new(
    MontFp!("373973480499824152749816795774535692130126081236112366"),
    MontFp!("239881760419386810121648775340825961114749150029120073"),
    MontFp!("1004641194455218522835921962111776576604869191168662685"),
);